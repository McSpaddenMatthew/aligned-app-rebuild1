<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Aligned â€“ Evidence-Based Candidate Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Simple, clean styling -->
  <style>
    :root {
      --bg: #0a0a0a;
      --card: #111827;
      --accent: #ff6b35;
      --accent-soft: rgba(255, 107, 53, 0.1);
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #1f2937;
      --danger: #f97373;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 50%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 80px;
      flex: 1;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 32px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--muted);
    }

    .logo-mark {
      width: 24px;
      height: 24px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--accent);
    }

    .btn {
      border-radius: 999px;
      padding: 8px 16px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #111827;
      font-weight: 600;
    }

    .btn-primary:disabled,
    .btn:disabled {
      opacity: 0.5;
      cursor: default;
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 24px;
    }

    @media (max-width: 800px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .hero {
      padding: 24px 24px 32px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: linear-gradient(145deg, var(--card), #020617);
      box-shadow: 0 18px 50px rgba(15, 23, 42, 0.6);
    }

    .hero-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .hero h1 {
      margin: 16px 0 8px;
      font-size: clamp(26px, 4vw, 32px);
    }

    .hero-sub {
      margin: 0 0 24px;
      color: var(--muted);
      font-size: 14px;
      max-width: 460px;
    }

    .hero-metrics {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 24px;
    }

    .metric {
      padding: 10px 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.9);
    }

    .metric-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
    }

    .metric-value {
      font-size: 16px;
      font-weight: 600;
    }

    .card {
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.95);
      padding: 18px 18px 20px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.7);
    }

    .card-title {
      font-size: 15px;
      font-weight: 500;
      margin: 0 0 6px;
    }

    .card-sub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 16px;
    }

    label {
      font-size: 12px;
      color: var(--muted);
      display: block;
      margin-bottom: 4px;
    }

    input, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      padding: 8px 10px;
      font-size: 14px;
      font-family: inherit;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    input:focus,
    textarea:focus {
      outline: 1px solid var(--accent);
      border-color: var(--accent);
    }

    .field {
      margin-bottom: 12px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 32px;
      margin-bottom: 10px;
    }

    .dashboard-title {
      font-size: 15px;
      font-weight: 500;
    }

    .dashboard-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 16px;
    }

    @media (max-width: 800px) {
      .dashboard-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .candidate-list {
      max-height: 360px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.9);
    }

    .candidate-empty {
      padding: 16px;
      font-size: 13px;
      color: var(--muted);
    }

    .candidate-row {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .candidate-row:last-child {
      border-bottom: none;
    }

    .candidate-name {
      font-size: 14px;
      font-weight: 500;
    }

    .candidate-meta {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .candidate-notes {
      font-size: 12px;
      color: #e5e7eb;
      margin-top: 4px;
    }

    .badge {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 11px;
      background: var(--accent-soft);
      color: var(--accent);
    }

    .status {
      font-size: 12px;
      color: var(--muted);
      margin-top: 8px;
    }

    .status.error {
      color: var(--danger);
    }

    footer {
      padding: 16px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
      border-top: 1px solid #020617;
      background: #020617;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-mark">A</div>
        <span>Aligned</span>
      </div>
      <button id="header-login-btn" class="btn">
        <span id="header-login-label">Log in</span>
      </button>
    </header>

    <main>
      <!-- HERO / MARKETING SIDE -->
      <section class="hero">
        <div class="hero-eyebrow">
          <span class="pill-dot"></span>
          Hiring managers want proof, not pitches
        </div>
        <h1>Hiring decisions need evidence. Recruiters need trust.</h1>
        <p class="hero-sub">
          Aligned turns messy intake notes and resumes into decision-ready candidate reports that speak your
          hiring managerâ€™s language.
        </p>

        <div style="display:flex; gap:10px; align-items:center;">
          <button id="hero-cta" class="btn btn-primary">
            Build my first summary â†’
          </button>
          <span style="font-size:12px; color:var(--muted);">
            No installs. Just log in with email.
          </span>
        </div>

        <div class="hero-metrics">
          <div class="metric">
            <div class="metric-label">For Recruiters</div>
            <div class="metric-value">From ignored to indispensable</div>
          </div>
          <div class="metric">
            <div class="metric-label">For Hiring Managers</div>
            <div class="metric-value">Your words â†’ our reports</div>
          </div>
          <div class="metric">
            <div class="metric-label">For PE & Exec Teams</div>
            <div class="metric-value">Fewer mis-hires, faster</div>
          </div>
        </div>
      </section>

      <!-- AUTH + DASHBOARD CARD -->
      <section>
        <!-- LOGIN CARD -->
        <div id="login-card" class="card">
          <p class="card-title">Log in or sign up</p>
          <p class="card-sub">
            Use your work email. Weâ€™ll send you a magic link â€“ no passwords to remember.
          </p>

          <form id="login-form">
            <div class="field">
              <label for="login-email">Work email</label>
              <input id="login-email" type="email" required placeholder="you@firm.com" />
            </div>
            <button id="login-submit" type="submit" class="btn btn-primary" style="width:100%; justify-content:center;">
              Send magic link
            </button>
          </form>
          <p id="login-status" class="status" style="margin-top:10px;"></p>
        </div>

        <!-- DASHBOARD CARD -->
        <div id="dashboard-card" class="card" style="display:none; margin-top:0;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
            <div>
              <p class="card-title">Your Aligned dashboard</p>
              <p class="card-sub" id="dashboard-subtitle">Loading your candidatesâ€¦</p>
            </div>
            <button id="logout-btn" class="btn" style="font-size:12px;">
              Log out
            </button>
          </div>

          <div class="dashboard-grid">
            <!-- New candidate form -->
            <div>
              <div class="pill" style="margin-bottom:10px;">
                <span class="pill-dot"></span>
                Step 1 Â· Capture a candidate
              </div>

              <form id="candidate-form">
                <div class="field">
                  <label for="candidate-name">Candidate name</label>
                  <input id="candidate-name" type="text" required placeholder="Jane Doe" />
                </div>
                <div class="field">
                  <label for="candidate-role">Role / search</label>
                  <input id="candidate-role" type="text" placeholder="VP of Data Strategy â€“ P3" />
                </div>
                <div class="field">
                  <label for="candidate-notes">What you want your HM to know</label>
                  <textarea id="candidate-notes" placeholder="Key outcomes, risks, how they frame data for leadershipâ€¦"></textarea>
                </div>
                <button id="candidate-submit" type="submit" class="btn btn-primary" style="width:100%; justify-content:center; margin-top:4px;">
                  Save candidate
                </button>
                <p id="candidate-status" class="status" style="margin-top:8px;"></p>
              </form>
            </div>

            <!-- Candidate list -->
            <div>
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span class="tag">Your recent candidates</span>
              </div>
              <div id="candidate-list" class="candidate-list">
                <div class="candidate-empty">
                  No candidates yet. Add one on the left to see it here.
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>
    </main>

    <section style="margin-top:32px;">
      <div class="dashboard-header">
        <div>
          <p class="dashboard-title">From intake call â†’ decision-ready report</p>
          <p class="dashboard-sub">
            Today: capture candidates and test the flow. Next: we plug in the AI summary engine and HM-share links.
          </p>
        </div>
      </div>
    </section>
  </div>

  <footer>
    Built for recruiters. Trusted by hiring managers. Aligned (test build).
  </footer>

  <!-- Supabase via CDN + app logic -->
  <script type="module">
    // ðŸ‘‰ðŸ‘‰ EDIT THESE TWO LINES ONLY ðŸ‘ˆðŸ‘ˆ
    const SUPABASE_URL = "https://YOUR-PROJECT-ID.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_ANON_PUBLIC_KEY";

    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: {
        persistSession: true,
        detectSessionInUrl: true,
        autoRefreshToken: true,
      },
    });

    // ------- DOM ELEMENTS -------
    const loginCard = document.getElementById("login-card");
    const dashboardCard = document.getElementById("dashboard-card");
    const loginForm = document.getElementById("login-form");
    const loginEmailInput = document.getElementById("login-email");
    const loginStatus = document.getElementById("login-status");
    const loginSubmit = document.getElementById("login-submit");
    const headerLoginBtn = document.getElementById("header-login-btn");
    const headerLoginLabel = document.getElementById("header-login-label");
    const heroCta = document.getElementById("hero-cta");
    const logoutBtn = document.getElementById("logout-btn");
    const dashboardSubtitle = document.getElementById("dashboard-subtitle");

    const candidateForm = document.getElementById("candidate-form");
    const candidateNameInput = document.getElementById("candidate-name");
    const candidateRoleInput = document.getElementById("candidate-role");
    const candidateNotesInput = document.getElementById("candidate-notes");
    const candidateStatus = document.getElementById("candidate-status");
    const candidateList = document.getElementById("candidate-list");
    const candidateSubmit = document.getElementById("candidate-submit");

    // ------- UI HELPERS -------
    function showLogin() {
      loginCard.style.display = "block";
      dashboardCard.style.display = "none";
      headerLoginLabel.textContent = "Log in";
    }

    function showDashboard() {
      loginCard.style.display = "none";
      dashboardCard.style.display = "block";
      headerLoginLabel.textContent = "Dashboard";
    }

    function setLoginLoading(isLoading) {
      loginSubmit.disabled = isLoading;
      loginSubmit.textContent = isLoading ? "Sending linkâ€¦" : "Send magic link";
    }

    function setCandidateLoading(isLoading) {
      candidateSubmit.disabled = isLoading;
      candidateSubmit.textContent = isLoading ? "Savingâ€¦" : "Save candidate";
    }

    // ------- AUTH FLOW -------
    async function sendMagicLink(email) {
      setLoginLoading(true);
      loginStatus.textContent = "";
      loginStatus.classList.remove("error");

      try {
        const { error } = await supabase.auth.signInWithOtp({
          email,
          options: {
            emailRedirectTo: window.location.href.split("#")[0].split("?")[0],
          },
        });

        if (error) throw error;

        loginStatus.textContent = "Magic link sent. Check your email to finish logging in.";
      } catch (err) {
        console.error(err);
        loginStatus.textContent = "Error sending magic link. Double-check the email and try again.";
        loginStatus.classList.add("error");
      } finally {
        setLoginLoading(false);
      }
    }

    async function refreshUserState() {
      const { data, error } = await supabase.auth.getUser();
      const user = data?.user || null;

      if (error) {
        console.error("Error getting user", error);
      }

      if (user) {
        showDashboard();
        dashboardSubtitle.textContent = `Logged in as ${user.email}`;
        loadCandidates();
      } else {
        showLogin();
      }
    }

    // Handle auth changes (e.g., after magic link redirect)
    supabase.auth.onAuthStateChange((_event, session) => {
      if (session?.user) {
        showDashboard();
        dashboardSubtitle.textContent = `Logged in as ${session.user.email}`;
        loadCandidates();
      } else {
        showLogin();
      }
    });

    // ------- CANDIDATE CRUD -------
    async function loadCandidates() {
      candidateList.innerHTML = `
        <div class="candidate-empty">
          Loading your candidatesâ€¦
        </div>
      `;

      const { data: userData } = await supabase.auth.getUser();
      const user = userData?.user;
      if (!user) {
        showLogin();
        return;
      }

      const { data, error } = await supabase
        .from("candidates")
        .select("*")
        .eq("user_id", user.id)
        .order("created_at", { ascending: false });

      if (error) {
        console.error("Error loading candidates", error);
        candidateList.innerHTML = `
          <div class="candidate-empty">
            Error loading candidates. Check Supabase console for details.
          </div>
        `;
        return;
      }

      if (!data || data.length === 0) {
        candidateList.innerHTML = `
          <div class="candidate-empty">
            No candidates yet. Add one on the left to see it here.
          </div>
        `;
        return;
      }

      candidateList.innerHTML = "";
      data.forEach((row) => {
        const div = document.createElement("div");
        div.className = "candidate-row";

        const created = row.created_at
          ? new Date(row.created_at).toLocaleString()
          : "";

        div.innerHTML = `
          <div class="candidate-name">${row.candidate_name}</div>
          <div class="candidate-meta">
            <span>${row.role || "Unspecified role"}</span>
            <span class="badge">Draft HM summary</span>
            <span>${created}</span>
          </div>
          ${
            row.notes
              ? `<div class="candidate-notes">${row.notes.replace(
                  /\n/g,
                  "<br/>"
                )}</div>`
              : ""
          }
        `;
        candidateList.appendChild(div);
      });
    }

    async function saveCandidate() {
      candidateStatus.textContent = "";
      candidateStatus.classList.remove("error");

      const name = candidateNameInput.value.trim();
      const role = candidateRoleInput.value.trim();
      const notes = candidateNotesInput.value.trim();

      if (!name) {
        candidateStatus.textContent = "Candidate name is required.";
        candidateStatus.classList.add("error");
        return;
      }

      const { data: userData } = await supabase.auth.getUser();
      const user = userData?.user;
      if (!user) {
        showLogin();
        return;
      }

      try {
        setCandidateLoading(true);

        const { error } = await supabase.from("candidates").insert({
          user_id: user.id,
          candidate_name: name,
          role: role || null,
          notes: notes || null,
        });

        if (error) throw error;

        candidateStatus.textContent = "Candidate saved.";
        candidateNameInput.value = "";
        candidateRoleInput.value = "";
        candidateNotesInput.value = "";

        loadCandidates();
      } catch (err) {
        console.error("Error saving candidate", err);
        candidateStatus.textContent = "Error saving candidate.";
        candidateStatus.classList.add("error");
      } finally {
        setCandidateLoading(false);
      }
    }

    async function logout() {
      await supabase.auth.signOut();
      candidateList.innerHTML = "";
      showLogin();
      dashboardSubtitle.textContent = "";
    }

    // ------- EVENT LISTENERS -------
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = loginEmailInput.value.trim();
      if (!email) return;
      sendMagicLink(email);
    });

    candidateForm.addEventListener("submit", (e) => {
      e.preventDefault();
      saveCandidate();
    });

    logoutBtn.addEventListener("click", () => {
      logout();
    });

    headerLoginBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
      if (loginCard.style.display !== "none") {
        loginEmailInput.focus();
      }
    });

    heroCta.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
      if (loginCard.style.display !== "none") {
        loginEmailInput.focus();
      }
    });

    // ------- INITIAL LOAD -------
    refreshUserState();
  </script>
</body>
</html>
